import{Scene as e,OrthographicCamera as t,WebGLRenderer as n,TextureLoader as i,LinearFilter as o,VideoTexture as a,ShaderMaterial as r,Vector4 as s,PlaneBufferGeometry as f,Mesh as d}from"three";import l from"gsap";export default function(u){function v(){for(var e=arguments,t=0;t<arguments.length;t++)if(void 0!==e[t])return e[t]}var m=u.parent,p=u.displacementImage,c=u.image1,g=u.image2,h=v(u.imagesRatio,1),y=v(u.intensity1,u.intensity,1),x=v(u.intensity2,u.intensity,1),F=v(u.angle,Math.PI/4),w=v(u.angle1,F),H=v(u.angle2,3*-F),W=v(u.speedIn,u.speed,1.6),E=v(u.speedOut,u.speed,1.2),P=v(u.hover,!0),U=v(u.easing,"expo.out"),C=v(u.video,!1);if(m)if(c&&g&&p){var L=new e,V=new t(m.offsetWidth/-2,m.offsetWidth/2,m.offsetHeight/2,m.offsetHeight/-2,1,1e3);V.position.z=1;var _=new n({antialias:!1,alpha:!0});_.setPixelRatio(2),_.setClearColor(16777215,0),_.setSize(m.offsetWidth,m.offsetHeight),m.appendChild(_.domElement);var D=function(){_.render(L,V)},M=new i;M.crossOrigin="";var R,z,S=M.load(p,D);if(S.magFilter=S.minFilter=o,C){var I=function(){requestAnimationFrame(I),_.render(L,V)};I(),(C=document.createElement("video")).autoplay=!0,C.loop=!0,C.src=c,C.load();var O=document.createElement("video");O.autoplay=!0,O.loop=!0,O.src=g,O.load();var j=new a(C),q=new a(O);j.magFilter=q.magFilter=o,j.minFilter=q.minFilter=o,O.addEventListener("loadeddata",function(){O.play(),(q=new a(O)).magFilter=o,q.minFilter=o,b.uniforms.texture2.value=q},!1),C.addEventListener("loadeddata",function(){C.play(),(j=new a(C)).magFilter=o,j.minFilter=o,b.uniforms.texture1.value=j},!1)}else j=M.load(c,D),q=M.load(g,D),j.magFilter=q.magFilter=o,j.minFilter=q.minFilter=o;var A=h;m.offsetHeight/m.offsetWidth<A?(R=1,z=m.offsetHeight/m.offsetWidth/A):(R=m.offsetWidth/m.offsetHeight*A,z=1);var b=new r({uniforms:{intensity1:{type:"f",value:y},intensity2:{type:"f",value:x},dispFactor:{type:"f",value:0},angle1:{type:"f",value:w},angle2:{type:"f",value:H},texture1:{type:"t",value:j},texture2:{type:"t",value:q},disp:{type:"t",value:S},res:{type:"vec4",value:new s(m.offsetWidth,m.offsetHeight,R,z)},dpr:{type:"f",value:window.devicePixelRatio}},vertexShader:"\nvarying vec2 vUv;\nvoid main() {\n  vUv = uv;\n  gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}\n",fragmentShader:"\nvarying vec2 vUv;\n\nuniform float dispFactor;\nuniform float dpr;\nuniform sampler2D disp;\n\nuniform sampler2D texture1;\nuniform sampler2D texture2;\nuniform float angle1;\nuniform float angle2;\nuniform float intensity1;\nuniform float intensity2;\nuniform vec4 res;\nuniform vec2 parent;\n\nmat2 getRotM(float angle) {\n  float s = sin(angle);\n  float c = cos(angle);\n  return mat2(c, -s, s, c);\n}\n\nvoid main() {\n  vec4 disp = texture2D(disp, vUv);\n  vec2 dispVec = vec2(disp.r, disp.g);\n\n  vec2 uv = 0.5 * gl_FragCoord.xy / (res.xy) ;\n  vec2 myUV = (uv - vec2(0.5))*res.zw + vec2(0.5);\n\n\n  vec2 distortedPosition1 = myUV + getRotM(angle1) * dispVec * intensity1 * dispFactor;\n  vec2 distortedPosition2 = myUV + getRotM(angle2) * dispVec * intensity2 * (1.0 - dispFactor);\n  vec4 _texture1 = texture2D(texture1, distortedPosition1);\n  vec4 _texture2 = texture2D(texture2, distortedPosition2);\n  gl_FragColor = mix(_texture1, _texture2, dispFactor);\n}\n",transparent:!0,opacity:1}),k=new f(m.offsetWidth,m.offsetHeight,1),B=new d(k,b);L.add(B),P&&(m.addEventListener("mouseenter",G),m.addEventListener("touchstart",G),m.addEventListener("mouseleave",J),m.addEventListener("touchend",J)),window.addEventListener("resize",function(e){m.offsetHeight/m.offsetWidth<A?(R=1,z=m.offsetHeight/m.offsetWidth/A):(R=m.offsetWidth/m.offsetHeight*A,z=1),B.material.uniforms.res.value=new s(m.offsetWidth,m.offsetHeight,R,z),_.setSize(m.offsetWidth,m.offsetHeight),D()}),this.next=G,this.previous=J}else console.warn("One or more images are missing");else console.warn("Parent missing");function G(){l.to(b.uniforms.dispFactor,{value:1,duration:W,ease:U,onUpdate:D,onComplete:D})}function J(){l.to(b.uniforms.dispFactor,{value:0,duration:E,ease:U,onUpdate:D,onComplete:D})}}
//# sourceMappingURL=hover-effect.es.js.map
