import*as e from"three";import t from"gsap";function i(i){function n(){for(var e=0;e<arguments.length;e++)if(void 0!==arguments[e])return arguments[e]}var r=i.parent,o=i.displacementImage,a=i.image1,s=i.image2,d=n(i.imagesRatio,1),f=n(i.intensity1,i.intensity,1),l=n(i.intensity2,i.intensity,1),u=n(i.angle,Math.PI/4),v=n(i.angle1,u),m=n(i.angle2,3*-u),p=n(i.speedIn,i.speed,1.6),c=n(i.speedOut,i.speed,1.2),g=n(i.hover,!0),h=n(i.easing,"expo.out"),y=n(i.video,!1);if(!r)return void console.warn("Parent missing");if(!(a&&s&&o))return void console.warn("One or more images are missing");var F=new e.Scene,x=new e.OrthographicCamera(r.offsetWidth/-2,r.offsetWidth/2,r.offsetHeight/2,r.offsetHeight/-2,1,1e3);x.position.z=1;var w=new e.WebGLRenderer({antialias:!1,alpha:!0});w.setPixelRatio(2),w.setClearColor(16777215,0),w.setSize(r.offsetWidth,r.offsetHeight),r.appendChild(w.domElement);var L=function(){w.render(F,x)},W=new e.TextureLoader;W.crossOrigin="";var H=W.load(o,L);if(H.magFilter=H.minFilter=e.LinearFilter,y){!function e(){requestAnimationFrame(e),w.render(F,x)}(),(y=document.createElement("video")).autoplay=!0,y.loop=!0,y.src=a,y.load();var V=document.createElement("video");V.autoplay=!0,V.loop=!0,V.src=s,V.load();var E=new e.VideoTexture(y),P=new e.VideoTexture(V);E.magFilter=P.magFilter=e.LinearFilter,E.minFilter=P.minFilter=e.LinearFilter,V.addEventListener("loadeddata",function(){V.play(),(P=new e.VideoTexture(V)).magFilter=e.LinearFilter,P.minFilter=e.LinearFilter,R.uniforms.texture2.value=P},!1),y.addEventListener("loadeddata",function(){y.play(),(E=new e.VideoTexture(y)).magFilter=e.LinearFilter,E.minFilter=e.LinearFilter,R.uniforms.texture1.value=E},!1)}else E=W.load(a,L),P=W.load(s,L),E.magFilter=P.magFilter=e.LinearFilter,E.minFilter=P.minFilter=e.LinearFilter;let U,C;var M=d;r.offsetHeight/r.offsetWidth<M?(U=1,C=r.offsetHeight/r.offsetWidth/M):(U=r.offsetWidth/r.offsetHeight*M,C=1);var R=new e.ShaderMaterial({uniforms:{intensity1:{type:"f",value:f},intensity2:{type:"f",value:l},dispFactor:{type:"f",value:0},angle1:{type:"f",value:v},angle2:{type:"f",value:m},texture1:{type:"t",value:E},texture2:{type:"t",value:P},disp:{type:"t",value:H},res:{type:"vec4",value:new e.Vector4(r.offsetWidth,r.offsetHeight,U,C)},dpr:{type:"f",value:window.devicePixelRatio}},vertexShader:"\nvarying vec2 vUv;\nvoid main() {\n  vUv = uv;\n  gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}\n",fragmentShader:"\nvarying vec2 vUv;\n\nuniform float dispFactor;\nuniform float dpr;\nuniform sampler2D disp;\n\nuniform sampler2D texture1;\nuniform sampler2D texture2;\nuniform float angle1;\nuniform float angle2;\nuniform float intensity1;\nuniform float intensity2;\nuniform vec4 res;\nuniform vec2 parent;\n\nmat2 getRotM(float angle) {\n  float s = sin(angle);\n  float c = cos(angle);\n  return mat2(c, -s, s, c);\n}\n\nvoid main() {\n  vec4 disp = texture2D(disp, vUv);\n  vec2 dispVec = vec2(disp.r, disp.g);\n\n  vec2 uv = 0.5 * gl_FragCoord.xy / (res.xy) ;\n  vec2 myUV = (uv - vec2(0.5))*res.zw + vec2(0.5);\n\n\n  vec2 distortedPosition1 = myUV + getRotM(angle1) * dispVec * intensity1 * dispFactor;\n  vec2 distortedPosition2 = myUV + getRotM(angle2) * dispVec * intensity2 * (1.0 - dispFactor);\n  vec4 _texture1 = texture2D(texture1, distortedPosition1);\n  vec4 _texture2 = texture2D(texture2, distortedPosition2);\n  gl_FragColor = mix(_texture1, _texture2, dispFactor);\n}\n",transparent:!0,opacity:1}),_=new e.PlaneBufferGeometry(r.offsetWidth,r.offsetHeight,1),D=new e.Mesh(_,R);function S(){t.to(R.uniforms.dispFactor,{value:1,duration:p,ease:h,onUpdate:L,onComplete:L})}function z(){t.to(R.uniforms.dispFactor,{value:0,duration:c,ease:h,onUpdate:L,onComplete:L})}F.add(D),g&&(r.addEventListener("mouseenter",S),r.addEventListener("touchstart",S),r.addEventListener("mouseleave",z),r.addEventListener("touchend",z)),window.addEventListener("resize",function(t){r.offsetHeight/r.offsetWidth<M?(U=1,C=r.offsetHeight/r.offsetWidth/M):(U=r.offsetWidth/r.offsetHeight*M,C=1),D.material.uniforms.res.value=new e.Vector4(r.offsetWidth,r.offsetHeight,U,C),w.setSize(r.offsetWidth,r.offsetHeight),L()}),this.next=S,this.previous=z}export{i as default};
//# sourceMappingURL=hover-effect.modern.js.map
